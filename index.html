<html><head><meta charset="utf-8" /><!-- Always force latest IE rendering engine or request Chrome Frame --><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><title>Danger - Stop Saying "You Forgot To..." in Code Review</title><link href="/stylesheets/style-9be1f564.css" rel="stylesheet" /><link href="/stylesheets/highlight-53578f94.css" rel="stylesheet" /><script src="https://code.jquery.com/jquery-3.0.0.slim.min.js"></script></head><body class="index"><code class="byline">a project from <a href="http://orta.io">orta therox</a> and <a href="http://krausefx">felix krause</a>.</code><header class="title"><p>Danger</p><img src="/images/title-704b3238.png" class="retina" alt="Danger title image" width="980" height="236" /><nav><ul><li><a class="highlighted" href="/">home</a></li><li><a href="/guides.html">Guides</a></li><li><a href="/reference.html">Reference</a></li></ul></nav></header><section><h2><span>What is Danger?</span></h2><article><p>Danger runs after your CI, and gives teams the chance to automate common code review chores.</p><p>This provides another logical step in your process, through this Danger can help lint your rote tasks in daily code review.</p><p>You can use Danger to codify your teams norms. Leaving humans to think about harder problems.</p></article><div class="clearfix"></div></section><section class="examples"><h2><span>For Example</span></h2><div class="example_content"><ul><li class="changelogs" data-repos="artsy/eigen, cocoapods/cocoapods, realm/jazzy"><a>Enforce Changelogs</a></li><li class="prose" data-repos="artsy/artsy.github.io, ashfurrow/blog"><a>Improve your prose</a></li><li class="merge" data-repos="cocoapods/cocoapods"><a>Ensure no Merge commits</a></li><li class="focus" data-repos="artsy/artsy.github.io, ashfurrow/blog"><a>Dont Focus Tests</a></li><li class="artifacts" data-repos="samdmarshall/pyconfig, artsy/eigen, fastlane/fastlane"><a>Highlight build artifacts</a></li><li class="special" data-repos="samdmarshall/pyconfig, artsy/eigen, fastlane/fastlane"><a>Special case special files</a></li></ul><div><div class="code_chunk"><div class="changelogs"><div class="highlight"><pre><span class="c1"># Add a CHANGELOG entry for app changes</span>
<span class="k">if</span> <span class="o">!</span><span class="n">github</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;CHANGELOG.md&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">has_app_changes</span>
  <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;Please include a CHANGELOG entry. </span><span class="se">\n</span><span class="s2">You can find it at [CHANGELOG.md](https://github.com/realm/jazzy/blob/master/CHANGELOG.md).&quot;</span><span class="p">)</span>
  <span class="n">message</span> <span class="s2">&quot;Note, we hard-wrap at 80 chars and use 2 spaces after the last line.&quot;</span>
<span class="k">end</span>
</pre></div></div><div class="prose"><div class="highlight"><pre><span class="c1"># Look for prose issues</span>
<span class="n">prose</span><span class="o">.</span><span class="n">lint_files</span> <span class="n">markdown_files</span>

<span class="c1"># Look for spelling issues</span>
<span class="n">prose</span><span class="o">.</span><span class="n">ignored_words</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;orta&quot;</span><span class="p">,</span> <span class="s2">&quot;artsy&quot;</span><span class="p">,</span> <span class="s2">&quot;cocoapods&quot;</span><span class="o">]</span>
<span class="n">prose</span><span class="o">.</span><span class="n">check_spelling</span> <span class="n">markdown_files</span>
</pre></div></div><div class="merge"><div class="highlight"><pre><span class="c1"># Ensure a clean commits history</span>
<span class="k">if</span> <span class="n">commits</span><span class="o">.</span><span class="n">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">message</span> <span class="o">=~</span> <span class="sr">/^Merge branch/</span> <span class="p">}</span>
  <span class="nb">fail</span><span class="p">(</span><span class="s1">&#39;Please rebase to get rid of the merge commits in this PR&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div><div class="focus"><div class="highlight"><pre><span class="c1"># Don&#39;t let testing shortcuts get into master by accident</span>
<span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;fit left in tests&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="sb">`grep -r &quot;fit Demo/Tests/ `</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
</pre></div></div><div class="artifacts"><div class="highlight"><pre><span class="n">username</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;CIRCLE_PROJECT_USERNAME&#39;</span><span class="o">]</span>
<span class="n">project_name</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;CIRCLE_PROJECT_REPONAME&#39;</span><span class="o">]</span>
<span class="n">build_number</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;CIRCLE_BUILD_NUM&#39;</span><span class="o">]</span>
<span class="k">if</span> <span class="n">username</span> <span class="o">&amp;&amp;</span> <span class="n">project_name</span> <span class="o">&amp;&amp;</span> <span class="n">build_number</span>
  <span class="c1"># submit message giving the coverage report that was generated by coverage.py</span>
  <span class="n">message</span><span class="p">(</span><span class="s1">&#39;[html coverage report](https://circleci.com/api/v1/project/&#39;</span><span class="o">+</span><span class="n">username</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">project_name</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">build_number</span><span class="o">+</span><span class="s1">&#39;/artifacts/0/$CIRCLE_ARTIFACTS/htmlcov/index.html)&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div><div class="special"><div class="highlight"><pre><span class="c1"># Did you make analytics changes? Well you should also include a change to our analytics spec</span>
<span class="n">made_analytics_changes</span> <span class="o">=</span> <span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;/Artsy/App/ARAppDelegate+Analytics.m&quot;</span><span class="p">)</span>
<span class="n">made_analytics_specs_changes</span> <span class="o">=</span> <span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;/Artsy_Tests/Analytics_Tests/ARAppAnalyticsSpec.m&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">made_analytics_changes</span>
    <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;Analytics changes should have reflected specs changes&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">made_analytics_specs_changes</span>

    <span class="c1"># And pay extra attention anyway</span>
    <span class="n">message</span><span class="p">(</span><span class="s1">&#39;Analytics dict changed, double check for ?: `@&quot;&quot;` on new entries&#39;</span><span class="p">)</span>
    <span class="n">message</span><span class="p">(</span><span class="s1">&#39;Also, double check the [Analytics Eigen schema](https://docs.google.com/spreadsheets/u/1/d/1bLbeOgVFaWzLSjxLOBDNOKs757-zBGoLSM1lIz3OPiI/edit#gid=497747862) if the changes are non-trivial.&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div><ref># See artsy/eigen</ref><div class="clearfix"></div></div></div></section><section><h2><span>What magic is this?</span></h2><article><h3>How</h3><p>Danger is ruby gem that runs a <code>Dangerfile</code>, you set up a <code>Dangerfile</code> per-project. The <code>Dangerfile</code> contains a collection of home-grown rules specific to your project.</p>

<p>Danger should be installed via a Gemfile. Add <code>gem "danger"</code> to your Gemfile, then run <code>bundle</code>.</p>

<p>You can integrate Danger into your own project on any available CI service. She will run through the process with you if you run  <code>danger init</code> after installation.</p>
</article><article><h3>Supports</h3><p><strong>Can be run on</strong>: Circle, Travis, Jenkins, Buildkite, Xcode Bots, Drone.</p><p><strong>Can chat back on</strong>: GitHub</p><p><strong>Can handle diffs from</strong>: Git</p><h3>Danger DSL</h3><p><code>
message("message") - Declares a CI message
warn("message") - Declares a CI warning
fail("message") - Declares a CI blocking error
markdown("message") - Outputs markdown
</code></p>
</article><div class="clearfix"></div><section><h2><span>Plugins</span></h2><article><p>Danger was built to be a small core, which allows others to extend her DSL via gems as plugins. You can create a new one with `danger plugin create`.</p></article><div class="clearfix"></div><article class="scope_code"><h3>DangerProse</h3><p>Lint markdown files inside your projects.
This is done using the <a href="http://proselint.com">proselint</a> python egg.
Results are passed out as a table in markdown.</p>
<h3>Reference</h3><h4>Attributes</h4><div class="fake_code"><p>Allows you to disable a collection of linters from being ran.
You can get a list of <a href="https://github.com/amperser/proselint#checks">them here</a></p>
</div><code>disable_linters</code><h4>Methods</h4><div class="fake_code"><p>Lints the globbed files, will only fail if <code>proselint</code> cannot be installed correctly.
Generates a <code>markdown</code> list of warnings for the prose in a corpus of .markdown and .md files.</p>
</div><code>lint_files(<span class='subtle'>files</span><span class='subtle return'>String<span>)</code><div class="fake_code"><p>Determine if proselint is currently installed in the system paths.</p>
</div><code>proselint_installed?()<span class='subtle return'>Bool</span></code></article><article class="scope_code"><h3>Examples</h3><h4>Specifying custom CocoaPods installation options</h4><div class="highlight"><pre><span class="c1"># Runs a linter with comma style disabled</span>
<span class="n">proselint</span><span class="o">.</span><span class="n">disable_linters</span> <span class="o">=</span> <span class="o">[</span><span class="err">“</span><span class="n">misc</span><span class="o">.</span><span class="n">scare_quotes</span><span class="err">”</span><span class="p">,</span> <span class="s2">&quot;misc.tense_present&quot;</span><span class="o">]</span>
<span class="n">proselint</span><span class="o">.</span><span class="n">lint_files</span> <span class="err">“</span><span class="n">_posts</span><span class="o">/*.</span><span class="n">md</span><span class="err">”</span>

<span class="c1"># Runs a linter with all styles, on modified and added markpown files in this PR</span>
<span class="n">proselint</span><span class="o">.</span><span class="n">lint_files</span>
</pre></div><h3>Tags</h3><code></code><h3>See in Action</h3><ul><li><a href="https://github.com/artsy/artsy.github.io">artsy/artsy.github.io</a></li></ul></article><div class="clearfix"></div></section><section><h2><span>Meta</span></h2><article><p>Danger was built to be a small core, which allows others to extend her DSL via gems as plugins. You can create a new one with `danger plugin create`.</p></article><div class="clearfix"></div></section></section><script>$(function() {
  $("section.examples ul li").mouseover(function(event) {
    event.preventDefault()

    // Set the corresponding code
    var klass = $(this).attr("class").replace(" highlighted", "")

    // Set selection
    $("section.examples ul li").removeClass("highlighted")
    $(this).addClass("highlighted")

    $("section.examples div.code_chunk > div").css("display", "none")
    $("section.examples div.code_chunk div." + klass).css("display", "block")

     // Figure out the reference text
   var urls = $(this).data("repos").split(", ")
   var prs = "" //$(this).data("prs").split(", ")
   var toGithubLink = function(ref) {
       return "<a href='https://github.com/" + ref + "''>" + ref + "</a>"
    }
    var showArray = function(array) {
      if (array.length > 1) { return true }
      if (array.length == 0) { return false }
      return array[0].length > 0
    }

    // Set the reference text under the code for people to inspect
    var text = ""
    if (showArray(urls)) {
      text += "@see_repo " + urls.map(toGithubLink).join(", ")
    }
    if (showArray(urls) && showArray(prs)) {
      text += "<br/>"
    }
    if (showArray(prs)) {
      text += "@see_pr "+ prs.map(toGithubLink).join(", ")
    }
    $("section.examples ref").html(text)
  })

  // Set the selection to be the first
  $("section.examples ul li:first-child").trigger('mouseenter')
});</script></body></html>