<html><head><meta charset="utf-8" /><!-- Always force latest IE rendering engine or request Chrome Frame --><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><title>Danger - Stop Saying "You Forgot To..." in Code Review</title><link href="/stylesheets/style-4939387e.css" rel="stylesheet" /><link href="/stylesheets/highlight-53578f94.css" rel="stylesheet" /><script src="https://code.jquery.com/jquery-3.1.0.min.js"></script></head><body class="index"><code class="byline">a project from <a href="http://orta.io">orta therox</a> and <a href="https://krausefx.com">felix krause</a>.</code><header class="title"><p>Danger</p><img src="/images/title-88a50ec1.png" class="retina" alt="Danger title image" /><nav><ul><li><a class="highlighted" href="/">home</a></li><li><a href="/guides.html">Guides</a></li><li><a href="/reference.html">Reference</a></li></ul></nav></header><h2><span>What is Danger?</span></h2><section><article><p>Danger runs after your CI, and gives teams the chance to automate common code review chores.</p>

<p>This provides another logical step in your process, through this Danger can help lint your rote tasks in daily code review.</p>

<p>You can use Danger to codify your teams norms. Leaving humans to think about harder problems.</p>
</article></section><h2><span>For Example</span></h2><section class="examples"><ul><li class="changelogs" data-repos="artsy/eigen, cocoapods/cocoapods, realm/jazzy"><a>Enforce Changelogs</a></li><li class="prose" data-repos="artsy/artsy.github.io, ashfurrow/blog"><a>Improve your prose</a></li><li class="merge" data-repos="cocoapods/cocoapods"><a>Ensure no Merge commits</a></li><li class="focus" data-repos="artsy/artsy.github.io, ashfurrow/blog"><a>Dont Focus Tests</a></li><li class="artifacts" data-repos="samdmarshall/pyconfig, artsy/eigen, fastlane/fastlane"><a>Highlight build artifacts</a></li><li class="special" data-repos="samdmarshall/pyconfig, artsy/eigen, fastlane/fastlane"><a>Special case special files</a></li></ul><div><div class="code_chunk"><div class="changelogs"><div class="highlight"><pre><span class="c1"># Add a CHANGELOG entry for app changes</span>
<span class="k">if</span> <span class="o">!</span><span class="n">github</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;CHANGELOG.md&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">has_app_changes</span>
  <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;Please include a CHANGELOG entry. </span><span class="se">\n</span><span class="s2">You can find it at [CHANGELOG.md](https://github.com/realm/jazzy/blob/master/CHANGELOG.md).&quot;</span><span class="p">)</span>
  <span class="n">message</span> <span class="s2">&quot;Note, we hard-wrap at 80 chars and use 2 spaces after the last line.&quot;</span>
<span class="k">end</span>
</pre></div></div><div class="prose"><div class="highlight"><pre><span class="c1"># Look for prose issues</span>
<span class="n">prose</span><span class="o">.</span><span class="n">lint_files</span> <span class="n">markdown_files</span>

<span class="c1"># Look for spelling issues</span>
<span class="n">prose</span><span class="o">.</span><span class="n">ignored_words</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;orta&quot;</span><span class="p">,</span> <span class="s2">&quot;artsy&quot;</span><span class="p">,</span> <span class="s2">&quot;cocoapods&quot;</span><span class="o">]</span>
<span class="n">prose</span><span class="o">.</span><span class="n">check_spelling</span> <span class="n">markdown_files</span>
</pre></div></div><div class="merge"><div class="highlight"><pre><span class="c1"># Ensure a clean commits history</span>
<span class="k">if</span> <span class="n">commits</span><span class="o">.</span><span class="n">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">message</span> <span class="o">=~</span> <span class="sr">/^Merge branch/</span> <span class="p">}</span>
  <span class="nb">fail</span><span class="p">(</span><span class="s1">&#39;Please rebase to get rid of the merge commits in this PR&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div><div class="focus"><div class="highlight"><pre><span class="c1"># Don&#39;t let testing shortcuts get into master by accident</span>
<span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;fit left in tests&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="sb">`grep -r &quot;fit Demo/Tests/ `</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
</pre></div></div><div class="artifacts"><div class="highlight"><pre><span class="n">username</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;CIRCLE_PROJECT_USERNAME&#39;</span><span class="o">]</span>
<span class="n">project_name</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;CIRCLE_PROJECT_REPONAME&#39;</span><span class="o">]</span>
<span class="n">build_number</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;CIRCLE_BUILD_NUM&#39;</span><span class="o">]</span>
<span class="k">if</span> <span class="n">username</span> <span class="o">&amp;&amp;</span> <span class="n">project_name</span> <span class="o">&amp;&amp;</span> <span class="n">build_number</span>
  <span class="c1"># submit message giving the coverage report that was generated by coverage.py</span>
  <span class="n">message</span><span class="p">(</span><span class="s1">&#39;[html coverage report](https://circleci.com/api/v1/project/&#39;</span><span class="o">+</span><span class="n">username</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">project_name</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">build_number</span><span class="o">+</span><span class="s1">&#39;/artifacts/0/$CIRCLE_ARTIFACTS/htmlcov/index.html)&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div><div class="special"><div class="highlight"><pre><span class="c1"># Did you make analytics changes? Well you should also include a change to our analytics spec</span>
<span class="n">made_analytics_changes</span> <span class="o">=</span> <span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;/Artsy/App/ARAppDelegate+Analytics.m&quot;</span><span class="p">)</span>
<span class="n">made_analytics_specs_changes</span> <span class="o">=</span> <span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;/Artsy_Tests/Analytics_Tests/ARAppAnalyticsSpec.m&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">made_analytics_changes</span>
    <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;Analytics changes should have reflected specs changes&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">made_analytics_specs_changes</span>

    <span class="c1"># And pay extra attention anyway</span>
    <span class="n">message</span><span class="p">(</span><span class="s1">&#39;Analytics dict changed, double check for ?: `@&quot;&quot;` on new entries&#39;</span><span class="p">)</span>
    <span class="n">message</span><span class="p">(</span><span class="s1">&#39;Also, double check the [Analytics Eigen schema](https://docs.google.com/spreadsheets/u/1/d/1bLbeOgVFaWzLSjxLOBDNOKs757-zBGoLSM1lIz3OPiI/edit#gid=497747862) if the changes are non-trivial.&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div><ref></ref></div></section><h2><span>What magic is this?</span></h2><section><article><h3>How</h3><p>Danger is ruby gem that runs a <code>Dangerfile</code>, you set up a <code>Dangerfile</code> per-project. The <code>Dangerfile</code> contains a collection of home-grown rules specific to your project.</p>

<p>Danger should be installed via a Gemfile. Add <code>gem "danger"</code> to your Gemfile, then run <code>bundle</code>.</p>

<p>You can integrate Danger into your own project on any available CI service. She will run through the process with you if you run  <code>danger init</code> after installation.</p>
</article><article><h3>Supports</h3><p><strong>Can run on</strong>: Circle, Travis, Jenkins, Buildkite, Xcode Bots, Drone, SurfCI.</p><p><strong>Can chat back on</strong>: GitHub</p><p><strong>Can handle diffs from</strong>: Git</p><h3>Danger DSL</h3><p><code>
message("message") - Declares a CI message
warn("message") - Declares a CI warning
fail("message") - Declares a CI blocking error
markdown("message") - Outputs markdown
</code></p>
</article></section><h2><span>Plugins</span></h2><section><article><p>Danger was built to be a small core, which allows others to extend her DSL via gems as plugins. You can create a new one with <code>danger plugins create</code>.</p>
</article></section><section><article class="scope_code"><h3>DangerProse</h3><p>Lint markdown files inside your projects.
This is done using the <a href="http://proselint.com">proselint</a> python egg.
Results are passed out as a table in markdown.</p>
<h3>Reference</h3><h4>Attributes</h4><div class="fake_code"><p>Allows you to disable a collection of linters from running. Doesn&#39;t work yet.
You can get a list of <a href="https://github.com/amperser/proselint#checks">them here</a>
defaults to <code>[&quot;misc.scare_quotes&quot;, &quot;typography.symbols&quot;]</code> when it&#39;s nil.</p>
</div><code>disable_linters<span class='subtle return'>Array<String></span></code><div class="fake_code"><p>Allows you to add a collection of words to skip in spellchecking.
defaults to <code>[&quot;&quot;]</code> when it&#39;s nil.</p>
</div><code>ignored_words<span class='subtle return'>Array<String></span></code><h4>Methods</h4><div class="fake_code"><p>Lints the globbed markdown files. Will fail if <code>proselint</code> cannot be installed correctly.
Generates a <code>markdown</code> list of warnings for the prose in a corpus of .markdown and .md files.</p>
</div><code>lint_files(files: String)</code><div class="fake_code"><p>Determine if proselint is currently installed in the system paths.</p>
</div><code>proselint_installed?<span class='subtle return'>Bool</span></code><div class="fake_code"><p>Determine if mdspell is currently installed in the system paths.</p>
</div><code>mdspell_installed?<span class='subtle return'>Bool</span></code><div class="fake_code"><p>Runs a markdown-specific spell checker, against a corpus of <code>.markdown</code> and <code>.md</code> files.</p>
</div><code>check_spelling(files: String)</code></article><article class="scope_code"><h3>Examples</h3><h4>Running linter with custom disabled linters</h4><div class="highlight"><pre><span class="c1"># Runs a linter with comma style and tense present disabled</span>
<span class="n">prose</span><span class="o">.</span><span class="n">disable_linters</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;misc.scare_quotes&quot;</span><span class="p">,</span> <span class="s2">&quot;misc.tense_present&quot;</span><span class="o">]</span>
<span class="n">prose</span><span class="o">.</span><span class="n">lint_files</span> <span class="s2">&quot;_posts/*.md&quot;</span>
</pre></div><h4>Running linter with default linters</h4><div class="highlight"><pre><span class="c1"># Runs a linter with all styles, on modified and added markdown files in this PR</span>
<span class="n">prose</span><span class="o">.</span><span class="n">lint_files</span>
</pre></div><h4>Running the spell checker</h4><div class="highlight"><pre><span class="c1"># Runs a spell checker on all files in `_post`</span>
<span class="n">prose</span><span class="o">.</span><span class="n">check_spelling</span> <span class="s2">&quot;_posts/*.md&quot;</span>
</pre></div><h4>Running the spell checker, with some words whitelisted</h4><div class="highlight"><pre><span class="n">prose</span><span class="o">.</span><span class="n">ignored_words</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;orta&quot;</span><span class="p">,</span> <span class="s2">&quot;artsy&quot;</span><span class="o">]</span>
<span class="n">prose</span><span class="o">.</span><span class="n">check_spelling</span>
</pre></div><h3>Tags</h3><code>blogging, blog, writing, jekyll, middleman, hugo, metalsmith, gatsby, express</code><h3>See in Action</h3><ul><li><a href="https://github.com/artsy/artsy.github.io">artsy/artsy.github.io</a></li></ul></article><div class="clearfix"></div></section><h2><span>Show me some Dangerfiles</span></h2><section><article><p>Danger is used in all sorts of projects: ruby gems, python apps, xcode projects, blogs, npm websites and modules. You can check out some Dangerfiles from the Open Source community here.</p>
</article></section><section class="examples"><ul><li class="moya/moya" data-url="/dangerfiles/moya_moya.html"><a>moya<span>/</span>moya</a></li><li class="artsy/artsy.github.io" data-url="/dangerfiles/artsy_artsy.github.io.html"><a>artsy<span>/</span>artsy.github.io</a></li><li class="artsy/energy" data-url="/dangerfiles/artsy_energy.html"><a>artsy<span>/</span>energy</a></li><li class="artsy/eigen" data-url="/dangerfiles/artsy_eigen.html"><a>artsy<span>/</span>eigen</a></li><li class="fastlane/fastlane" data-url="/dangerfiles/fastlane_fastlane.html"><a>fastlane<span>/</span>fastlane</a></li><li class="danger/danger" data-url="/dangerfiles/danger_danger.html"><a>danger<span>/</span>danger</a></li><li class="cocoapods/cocoapods" data-url="/dangerfiles/cocoapods_cocoapods.html"><a>cocoapods<span>/</span>cocoapods</a></li></ul><div><div class="code_chunk"></div><ref></ref></div></section><h2><span>Meta</span></h2><section><article><p>Danger was built to be a small core, which allows others to extend her DSL via gems as plugins. You can create a new one with `danger plugins create`.</p></article></section><script>$(function() {
  $("section.examples ul li").mouseover(function(event) {
    event.preventDefault()
    console.log($(this))

    // Set the corresponding code
    var klass = $(this).attr("class").replace(" highlighted", "")

    // Set selection
    $(this).parent().children().removeClass("scope_code").removeClass("highlighted")
    $(this).addClass("highlighted")

    var parent = $(this).parents("section")
    // Is this selector for switching existing code samples?
    if ($(this).data("repos")) {
      $("div.code_chunk > div", parent).css("display", "none")
      $("div.code_chunk div." + klass, parent).css("display", "block")
    } else if( $(this).data("url") ) {
      $.get( $(this).data("url"), function(html) {
        console.log("OK")
          $("div.code_chunk", parent).empty()
          $("div.code_chunk", parent).append(html)
      })  
    }

     // Figure out the reference text
   var urls = $(this).data("repos") && $(this).data("repos").split(", ")
   var prs = "" //$(this).data("prs").split(", ")
   var toGithubLink = function(ref) {
       return "<a href='https://github.com/" + ref + "/blob/master/Dangerfile'>" + ref + "</a>"
    }
    var showArray = function(array) {
      if (!array) { return false }
      if (array.length > 1) { return true }
      if (array.length == 0) { return false }
      return array[0].length > 0
    }

    // Set the reference text under the code for people to inspect
    var text = ""
    if (showArray(urls)) {
      text += "@see_repo " + urls.map(toGithubLink).join(", ")
    }
    if (showArray(urls) && showArray(prs)) {
      text += "<br/>"
    }
    if (showArray(prs)) {
      text += "@see_pr "+ prs.map(toGithubLink).join(", ")
    }
    $("ref", parent).html(text)
  })

  // Set the selection to be the first
  $("section.examples ul li:first-child").trigger('mouseenter')
});</script></body></html>