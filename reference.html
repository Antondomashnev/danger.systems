<html><head><meta charset="utf-8" /><!-- Always force latest IE rendering engine or request Chrome Frame --><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="True" name="HandheldFriendly" /><meta content="480" name="MobileOptimized" /><meta content="width=480, initial-scale=0.6" name="viewport" /><meta content="constant integration culture code" name="keywords" /><meta content="Orta Therox & Felix Krause" name="author" /><meta content="summary" name="twitter:card" /><meta content="@orta" name="twitter:creator" /><meta content="Danger - Reference" name="twitter:title" /><meta content="Apply cultural rules during your CI process." name="twitter:description" /><meta content="http://danger.systems/reference.html" name="twitter:url" /><meta content="/images/square-ffd55d21.png" property="og:image" /><meta content="http://danger.systems/reference.html" property="og:url" /><title>Danger - Reference</title><link href="/stylesheets/style-cf6001f2.css" rel="stylesheet" /><link href="/stylesheets/highlight-53578f94.css" rel="stylesheet" /><script src="https://code.jquery.com/jquery-3.1.0.min.js"></script></head><body class="reference"><header class="title small"><p>Danger</p><a href="/"><img src="/images/title-88a50ec1.png" class="retina" alt="Danger title image" /></a><nav><ul><li><a href="/">home</a></li><li><a href="/guides.html">Guides</a></li><li class="big"><a class="highlighted" href="/reference.html">Reference</a></li><li class="small"><a class="highlighted" href="/reference.html">Ref</a></li></ul></nav></header><h2 class="reduced_top_margin"><span>Reference</span><code class="byline inline">a project from <a href="http://orta.io">orta therox</a> and <a href="https://krausefx.com">felix krause</a>.</code></h2><h2><span>git</span></h2><section><article class="scope_code"><h3>Reference</h3><h4>Methods</h4><div class="fake_code"><p>Paths for files that were added during the diff</p>
</div><code>added_files<span class='subtle return'>FileList<String></span></code><div class="fake_code"><p>Paths for files that were removed during the diff</p>
</div><code>deleted_files<span class='subtle return'>FileList<String></span></code><div class="fake_code"><p>Paths for files that changed during the diff</p>
</div><code>modified_files<span class='subtle return'>FileList<String></span></code><div class="fake_code"><p>The overall lines of code added/removed in the diff</p>
</div><code>lines_of_code<span class='subtle return'>Fixnum</span></code><div class="fake_code"><p>The overall lines of code removed in the diff</p>
</div><code>deletions<span class='subtle return'>Fixnum</span></code><div class="fake_code"><p>The overall lines of code added in the diff</p>
</div><code>insertions<span class='subtle return'>Fixnum</span></code><div class="fake_code"><p>The log of commits inside the diff</p>
</div><code>commits<span class='subtle return'>Git::Log</span></code></article><article class="scope_code"><h3>Examples</h3><h4>Do something to all new and edited markdown files</h4><div class="highlight"><pre><span class="n">markdowns</span> <span class="o">=</span> <span class="p">(</span><span class="n">git</span><span class="o">.</span><span class="n">added_files</span> <span class="o">+</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="p">)</span>
<span class="n">do_something</span> <span class="n">markdowns</span><span class="o">.</span><span class="n">select</span><span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="n">file</span><span class="o">.</span><span class="n">end_with?</span> <span class="s2">&quot;md&quot;</span> <span class="p">}</span>
</pre></div><h4>Don't allow a file to be deleted</h4><div class="highlight"><pre><span class="n">deleted</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">deleted_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;my/favourite.file&quot;</span>
<span class="nb">fail</span> <span class="s2">&quot;Don&#39;t delete my precious&quot;</span> <span class="k">if</span> <span class="n">deleted</span>
</pre></div><h4>Fail really big diffs</h4><div class="highlight"><pre><span class="nb">fail</span> <span class="s2">&quot;We cannot handle the scale of this PR&quot;</span> <span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">lines_of_code</span> <span class="o">&gt;</span> <span class="mi">50_000</span>
</pre></div><h4>Warn when there are merge commits in the diff</h4><div class="highlight"><pre><span class="k">if</span> <span class="n">commits</span><span class="o">.</span><span class="n">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">message</span> <span class="o">=~</span> <span class="sr">/^Merge branch &#39;master&#39;/</span> <span class="p">}</span>
   <span class="nb">warn</span> <span class="s1">&#39;Please rebase to get rid of the merge commits in this PR&#39;</span>
<span class="k">end</span>
</pre></div></article><div class="clearfix"></div></section><h2><span>github</span></h2><section><article class="scope_code"><h3>Reference</h3><h4>Methods</h4><div class="fake_code"><p>The title of the Pull Request.</p>
</div><code>pr_title<span class='subtle return'>String</span></code><div class="fake_code"><p>The body text of the Pull Request.</p>
</div><code>pr_body<span class='subtle return'>String</span></code><div class="fake_code"><p>The username of the author of the Pull Request.</p>
</div><code>pr_author<span class='subtle return'>String</span></code><div class="fake_code"><p>The labels assigned to the Pull Request.</p>
</div><code>pr_labels<span class='subtle return'>String</span></code><div class="fake_code"><p>The branch to which the PR is going to be merged into.</p>
</div><code>branch_for_base<span class='subtle return'>String</span></code><div class="fake_code"><p>The branch to which the PR is going to be merged from.</p>
</div><code>branch_for_head<span class='subtle return'>String</span></code><div class="fake_code"><p>The base commit to which the PR is going to be merged as a parent.</p>
</div><code>base_commit<span class='subtle return'>String</span></code><div class="fake_code"><p>The head commit to which the PR is requesting to be merged from.</p>
</div><code>head_commit<span class='subtle return'>String</span></code><div class="fake_code"><p>The hash that represents the PR&#39;s JSON. For an example of what this looks like
see the <a href="https://raw.githubusercontent.com/danger/danger/master/spec/fixtures/pr_response.json">Danger Fixture&#39;d one</a>.</p>
</div><code>pr_json<span class='subtle return'>Hash</span></code><div class="fake_code"><p>Provides access to the GitHub API client used inside Danger. Making
it easy to use the GitHub API inside a Dangerfile.</p>
</div><code>api<span class='subtle return'>Octokit::Client</span></code><div class="fake_code"><p>The unified diff produced by Github for this PR
see <a href="https://en.wikipedia.org/wiki/Diff_utility#Unified_format">Unified diff</a></p>
</div><code>pr_diff<span class='subtle return'>String</span></code><div class="fake_code"><p>Returns a HTML anchor for a file, or files in the head repository. An example would be:
<code>&lt;a href=&#39;https://github.com/artsy/eigen/blob/561827e46167077b5e53515b4b7349b8ae04610b/file.txt&#39;&gt;file.txt&lt;/a&gt;</code></p>
</div><code>html_link<span class='subtle return'>String</span></code></article><article class="scope_code"><h3>Examples</h3><h4>Warn when a PR is classed as work in progress</h4><div class="highlight"><pre><span class="nb">warn</span> <span class="s2">&quot;PR is classed as Work in Progress&quot;</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_title</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;[WIP]&quot;</span>
</pre></div><h4>Declare a PR to be simple to avoid specific Danger rules</h4><div class="highlight"><pre><span class="n">declared_trivial</span> <span class="o">=</span> <span class="p">(</span><span class="n">github</span><span class="o">.</span><span class="n">pr_title</span> <span class="o">+</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_body</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;#trivial&quot;</span><span class="p">)</span>
</pre></div><h4>Ensure that labels have been used on the PR</h4><div class="highlight"><pre><span class="nb">fail</span> <span class="s2">&quot;Please add labels to this PR&quot;</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">empty?</span>
</pre></div><h4>Check if a user is in a specific GitHub org, and message them if so</h4><div class="highlight"><pre><span class="k">unless</span> <span class="n">github</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">organization_member?</span><span class="p">(</span><span class="s1">&#39;danger&#39;</span><span class="p">,</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_author</span><span class="p">)</span>
  <span class="n">message</span> <span class="s2">&quot;@</span><span class="si">#{</span><span class="n">github</span><span class="o">.</span><span class="n">pr_author</span><span class="si">}</span><span class="s2"> is not a contributor yet, would you like to join the Danger org?&quot;</span>
<span class="k">end</span>
</pre></div><h4>Ensure there is a summary for a PR</h4><div class="highlight"><pre><span class="nb">fail</span> <span class="s2">&quot;Please provide a summary in the Pull Request description&quot;</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_body</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</pre></div><h4>Only accept PRs to the develop branch</h4><div class="highlight"><pre><span class="nb">fail</span> <span class="s2">&quot;Please re-submit this PR to develop, we may have already fixed your issue.&quot;</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">branch_for_base</span> <span class="o">!=</span> <span class="s2">&quot;develop&quot;</span>
</pre></div><h4>Note when PRs don't reference a milestone, which goes away when it does</h4><div class="highlight"><pre><span class="n">has_milestone</span> <span class="o">=</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_json</span><span class="o">[</span><span class="s2">&quot;milestone&quot;</span><span class="o">]</span> <span class="o">!=</span> <span class="kp">nil</span>
<span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;This PR does not refer to an existing milestone&quot;</span><span class="p">,</span> <span class="ss">sticky</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span> <span class="k">unless</span> <span class="n">has_milestone</span>
</pre></div><h4>Note when a PR cannot be manually merged, which goes away when you can</h4><div class="highlight"><pre><span class="n">can_merge</span> <span class="o">=</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_json</span><span class="o">[</span><span class="s2">&quot;mergeable&quot;</span><span class="o">]</span>
<span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;This PR cannot be merged yet.&quot;</span><span class="p">,</span> <span class="ss">sticky</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span> <span class="k">unless</span> <span class="n">can_merge</span>
</pre></div><h4>Highlight when a celebrity makes a pull request</h4><div class="highlight"><pre><span class="n">message</span> <span class="s2">&quot;Welcome, Danger.&quot;</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_author</span> <span class="o">==</span> <span class="s2">&quot;dangermcshane&quot;</span>
</pre></div><h4>Ensure that all PRs have an assignee</h4><div class="highlight"><pre><span class="nb">warn</span> <span class="s2">&quot;This PR does not have any assignees yet.&quot;</span> <span class="k">unless</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_json</span><span class="o">[</span><span class="s2">&quot;assignee&quot;</span><span class="o">]</span>
</pre></div><h4>Send a message with links to a collection of specific files</h4><div class="highlight"><pre><span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;config/*.js&quot;</span>
  <span class="n">config_files</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span> <span class="n">path</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;config/&quot;</span> <span class="p">}</span>
  <span class="n">message</span> <span class="s2">&quot;This PR changes </span><span class="si">#{</span> <span class="n">github</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="n">config_files</span><span class="p">)</span> <span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div><h4>Highlight with a clickable link if a Package.json is changed</h4><div class="highlight"><pre><span class="nb">warn</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">github</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="s2">&quot;Package.json&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2"> was edited.&quot;</span> <span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;Package.json&quot;</span>
</pre></div><h4>Note an issue with a particular line on a file using the #L[num] syntax, e.g. `#L23`</h4><div class="highlight"><pre><span class="n">linter_json</span> <span class="o">=</span> <span class="sb">`my_linter lint &quot;file&quot;`</span>
<span class="n">results</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span> <span class="n">linter_json</span>
<span class="k">unless</span> <span class="n">results</span><span class="o">.</span><span class="n">empty?</span>
  <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">warning</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span>
  <span class="nb">warn</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">github</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">#L</span><span class="si">#{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2"> has linter issue: </span><span class="si">#{</span><span class="n">warning</span><span class="si">}</span><span class="s2">.&quot;</span>
<span class="k">end</span>
</pre></div></article><div class="clearfix"></div></section><h2><span>plugin</span></h2><section><article class="scope_code"><h3>Reference</h3><h4>Methods</h4><div class="fake_code"><p>Download a local or remote plugin and use it inside the Dangerfile.</p>
</div><code>import(path_or_url: String)</code><div class="fake_code"><p>Download a local or remote plugin or Dangerfile
This method will not import the file for you, use plugin.import instead</p>
</div><code>download(path_or_url: String)<span class='subtle return'>String</span></code></article><article class="scope_code"><h3>Examples</h3><h4>Import a plugin available over HTTP</h4><div class="highlight"><pre><span class="n">device_grid</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/fastlane/fastlane/master/danger-device_grid/lib/device_grid/plugin.rb&quot;</span>
<span class="n">plugin</span><span class="o">.</span><span class="n">import</span> <span class="n">device_grid</span>
</pre></div><h4>Import from a local file reference</h4><div class="highlight"><pre><span class="n">plugin</span><span class="o">.</span><span class="n">import</span> <span class="s2">&quot;danger/plugins/watch_plugin.rb&quot;</span>
</pre></div><h4>Import all files inside a folder</h4><div class="highlight"><pre><span class="n">plugin</span><span class="o">.</span><span class="n">import</span> <span class="s2">&quot;danger/plugins/*.rb&quot;</span>
</pre></div></article><div class="clearfix"></div></section><h2><span>messaging</span></h2><section><article class="scope_code"><h3>Reference</h3><h4>Methods</h4><div class="fake_code"><p>Print markdown to below the table</p>
</div><code>markdown(message: String)</code><div class="fake_code"><p>Print out a generate message on the PR</p>
</div><code>message(message: String, sticky=true: Boolean)</code><div class="fake_code"><p>Specifies a problem, but not critical</p>
</div><code>warn(message: String, sticky=true: Boolean)</code><div class="fake_code"><p>Declares a CI blocking error</p>
</div><code>fail(message: String, sticky=true: Boolean)</code><div class="fake_code"><p>A list of all messages passed to Danger, including
the markdowns.</p>
</div><code>status_report<span class='subtle return'>Hash</span></code><div class="fake_code"><p>A list of all violations passed to Danger, we don&#39;t
anticipate users of Danger needing to use this.</p>
</div><code>violation_report<span class='subtle return'>Hash</span></code></article><article class="scope_code"><h3>Examples</h3><h4>Failing a build</h4><div class="highlight"><pre><span class="nb">fail</span> <span class="s2">&quot;This build didn&#39;t pass tests&quot;</span>
</pre></div><h4>Failing a build, but not keeping it's value around on subsequent runs</h4><div class="highlight"><pre><span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;This build didn&#39;t pass tests&quot;</span><span class="p">,</span> <span class="ss">sticky</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
</pre></div><h4>Passing a warning</h4><div class="highlight"><pre><span class="nb">warn</span> <span class="s2">&quot;This build didn&#39;t pass linting&quot;</span>
</pre></div><h4>Displaying a markdown table</h4><div class="highlight"><pre><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;### Proselint found issues</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Line | Message | Severity |</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;| --- | ----- | ----- |</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;20 | No documentation | Error </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">markdown</span> <span class="n">message</span>
</pre></div></article><div class="clearfix"></div></section><footer><article><h3>GitHub</h3><ul><li><a href="https://github.com/danger/danger">danger/danger</a></li></ul><h3>Twitter</h3><ul><li><a href="https://twitter.com/orta">@orta</a></li><li><a href="https://twitter.com/krausefx">@krausefx</a></li></ul></article><article><h3>Guides</h3><ul><li><a href="/guides/getting_started.html">Getting Set Up</a></li><li><a href="/guides/dangerfile.html">The Dangerfile</a></li><li><a href="/guides/what_does_danger_do.html">What does Danger do?</a></li><li><a href="/guides/creating_your_first_plugin.html">Creating your first Plugin</a></li><li><a href="/guides/a_quick_ruby_overview.html">A Quick Ruby Overview</a></li><li><a href="/guides/faq.html">Frequently Asked Questions</a></li><li><a href="/guides/troubleshooting.html">Troubleshooting</a></li></ul></article><article><h3>Misc</h3><ul><li><a href="/reference.html">DSL Reference</a></li><li><a href="https://github.com/danger/danger/blob/master/CHANGELOG.md">CHANGELOG.md</a></li><li><a href="https://github.com/danger/danger#license-contributors-guidelines-and-code-of-conduct">Code of Conduct</a></li><li><a href="https://github.com/danger/danger#license-contributors-guidelines-and-code-of-conduct">Community Continuity</a></li></ul></article><article><a href="/images/dm-opinions-316f5af1.png"><img height="244" src="/images/dm-opinions-316f5af1.png" width="203" /></a></article></footer></body></html><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-81285417-1', 'auto');
ga('send', 'pageview');</script>