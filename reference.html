<html><head><meta charset="utf-8" /><!-- Always force latest IE rendering engine or request Chrome Frame --><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><title>Danger - Reference</title><link href="/stylesheets/style-9be1f564.css" rel="stylesheet" /><link href="/stylesheets/highlight-53578f94.css" rel="stylesheet" /><script src="https://code.jquery.com/jquery-3.0.0.slim.min.js"></script></head><body class="reference"><code class="byline">a project from <a href="http://orta.io">orta therox</a> and <a href="http://krausefx">felix krause</a>.</code><header class="title"><p>Danger</p><img src="/images/title-704b3238.png" class="retina" alt="Danger title image" width="980" height="236" /><nav><ul><li><a href="/">home</a></li><li><a href="/guides.html">Guides</a></li><li><a class="highlighted" href="/reference.html">Reference</a></li></ul></nav></header><section><h2><span>Reference</span></h2><h2><span>git</span></h2><article class="scope_code"><p>Handles interacting with git inside a Dangerfile. Providing access to files that have changed, and useful statistics. Also provides
access to the commits in the form of <a href="https://github.com/schacon/ruby-git/blob/master/lib/git/log.rb">Git::Log</a> objects.</p>
<h3>Reference</h3><h4>Methods</h4><div class="fake_code"></div><code>instance_name()</code><div class="fake_code"><p>Paths for files that were added during the diff</p>
</div><code>added_files()<span class='subtle return'>FileList</span></code><div class="fake_code"><p>Paths for files that were removed during the diff</p>
</div><code>deleted_files()<span class='subtle return'>FileList</span></code><div class="fake_code"><p>Paths for files that changed during the diff</p>
</div><code>modified_files()<span class='subtle return'>FileList</span></code><div class="fake_code"><p>The overall lines of code added/removed in the diff</p>
</div><code>lines_of_code()</code><div class="fake_code"><p>The overall lines of code removed in the diff</p>
</div><code>deletions()</code><div class="fake_code"><p>The overall lines of code added in the diff</p>
</div><code>insertions()</code><div class="fake_code"><p>The log of commits inside the diff</p>
</div><code>commits()<span class='subtle return'>Git::Log</span></code></article><article class="scope_code"><h3>Examples</h3><h4>Do something to all new and edited markdown files</h4><div class="highlight"><pre><span class="n">markdowns</span> <span class="o">=</span> <span class="p">(</span><span class="n">git</span><span class="o">.</span><span class="n">added_files</span> <span class="o">+</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="p">)</span>
<span class="n">do_something</span> <span class="n">markdowns</span><span class="o">.</span><span class="n">select</span><span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="n">file</span><span class="o">.</span><span class="n">end_with?</span> <span class="s2">&quot;md&quot;</span> <span class="p">}</span>
</pre></div><h4>Don't allow a file to be deleted</h4><div class="highlight"><pre><span class="n">deleted</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">deleted_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;my/favourite.file&quot;</span>
<span class="nb">fail</span> <span class="s2">&quot;Don&#39;t delete my precious&quot;</span> <span class="k">if</span> <span class="n">deleted</span>
</pre></div><h4>Fail really big diffs</h4><div class="highlight"><pre><span class="nb">fail</span> <span class="s2">&quot;We cannot handle the scale of this PR&quot;</span> <span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">lines_of_code</span> <span class="o">&gt;</span> <span class="mi">50_000</span>
</pre></div><h4>Warn when there are merge commits in the diff</h4><div class="highlight"><pre><span class="k">if</span> <span class="n">commits</span><span class="o">.</span><span class="n">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">message</span> <span class="o">=~</span> <span class="sr">/^Merge branch &#39;master&#39;/</span> <span class="p">}</span>
   <span class="nb">warn</span> <span class="s1">&#39;Please rebase to get rid of the merge commits in this PR&#39;</span>
<span class="k">end</span>
</pre></div></article><div class="clearfix"></div><h2><span>github</span></h2><article class="scope_code"><p>Handles interacting with GitHub inside a Dangerfile. Provides a few functions which wrap <code>pr_json</code> and also
through a few standard functions to simplify your code.</p>
<h3>Reference</h3><h4>Methods</h4><div class="fake_code"></div><code>instance_name()</code><div class="fake_code"><p>The title of the Pull Request.</p>
</div><code>pr_title()</code><div class="fake_code"><p>The body text of the Pull Request.</p>
</div><code>pr_body()</code><div class="fake_code"><p>The username of the author of the Pull Request.</p>
</div><code>pr_author()</code><div class="fake_code"><p>The labels assigned to the Pull Request.</p>
</div><code>pr_labels()<span class='subtle return'>String</span></code><div class="fake_code"><p>The branch to which the PR is going to be merged into.</p>
</div><code>branch_for_base()</code><div class="fake_code"><p>The branch to which the PR is going to be merged from.</p>
</div><code>branch_for_head()</code><div class="fake_code"><p>The base commit to which the PR is going to be merged as a parent.</p>
</div><code>base_commit()</code><div class="fake_code"><p>The head commit to which the PR is requesting to be merged from.</p>
</div><code>head_commit()</code><div class="fake_code"><p>The hash that represents the PR&#39;s JSON. For an example of what this looks like
see the <a href="https://raw.githubusercontent.com/danger/danger/master/spec/fixtures/pr_response.json">Danger Fixture&#39;d one</a>.</p>
</div><code>pr_json()</code><div class="fake_code"><p>Provides access to the GitHub API client used inside Danger. Making
it easy to use the GitHub API inside a Dangerfile.</p>
</div><code>api()</code></article><article class="scope_code"><h3>Examples</h3><h4>Warn when a PR is classed as work in progress</h4><div class="highlight"><pre><span class="nb">warn</span> <span class="s2">&quot;PR is classed as Work in Progress&quot;</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_title</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;[WIP]&quot;</span>
</pre></div><h4>Ensure that labels have been used on the PR</h4><div class="highlight"><pre><span class="nb">fail</span> <span class="s2">&quot;Please add labels to this PR&quot;</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">empty?</span>
</pre></div><h4>Check if a user is in a specific GitHub org, and message them if so</h4><div class="highlight"><pre><span class="k">unless</span> <span class="n">github</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">organization_member?</span><span class="p">(</span><span class="s1">&#39;danger&#39;</span><span class="p">,</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_author</span><span class="p">)</span>
  <span class="n">message</span> <span class="s2">&quot;@</span><span class="si">#{</span><span class="n">pr_author</span><span class="si">}</span><span class="s2"> is not a contributor yet, would you like to join the Danger org?&quot;</span>
<span class="k">end</span>
</pre></div><h4>Ensure there is a summary for a PR</h4><div class="highlight"><pre><span class="nb">fail</span> <span class="s2">&quot;Please provide a summary in the Pull Request description&quot;</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_body</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</pre></div></article><div class="clearfix"></div><h2><span>plugin</span></h2><article class="scope_code"><p>One way to support internal plugins is via <code>plugin.import</code> this gives you
the chance to quickly iterate without the need for building rubygems. As such,
it does not have the stringent rules around documentation expected of a public plugin.
It&#39;s worth noting, that you can also have plugins inside <code>./danger_plugins</code> and they
will be automatically imported into your Dangerfile at launch.</p>
<h3>Reference</h3><h4>Methods</h4><div class="fake_code"></div><code>instance_name()</code><div class="fake_code"><p>Download a local or remote plugin and use it inside the Dangerfile.</p>
</div><code>import(<span class='subtle'>path</span><span class='subtle return'>String<span>)</code></article><article class="scope_code"><h3>Examples</h3><h4>Import a plugin available over HTTP</h4><div class="highlight"><pre><span class="n">device_grid</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/fastlane/fastlane/master/danger-device_grid/lib/device_grid/plugin.rb&quot;</span>
<span class="n">plugin</span><span class="o">.</span><span class="n">import</span> <span class="n">device_grid</span>
</pre></div><h4>Import from a local file reference</h4><div class="highlight"><pre><span class="n">plugin</span><span class="o">.</span><span class="n">import</span> <span class="s2">&quot;danger/plugins/watch_plugin.rb&quot;</span>
</pre></div><h4>Import all files inside a folder</h4><div class="highlight"><pre><span class="n">plugin</span><span class="o">.</span><span class="n">import</span> <span class="s2">&quot;danger/plugins/*.rb&quot;</span>
</pre></div></article><div class="clearfix"></div><h2><span>messaging</span></h2><article class="scope_code"><p>Provides the feedback mechanism for Danger. Danger can keep track of
messages, warnings, failure and post arbitrary markdown into a comment.</p>

<p>The message within which Danger communicates back is amended on each run in a session.</p>

<p>Each of <code>message</code>, <code>warn</code> and <code>fail</code> have a <code>sticky</code> flag, <code>true</code> by default, which
means that the message will be crossed out instead of being removed. If it&#39;s not use on
subsequent runs.</p>

<p>By default, using <code>fail</code> would fail the corresponding build. Either via an API call, or
via the return value for the danger command.</p>

<p>It is possible to have Danger ignore specific warnings or errors by writing <code>Danger: Ignore &quot;[warning/error text]</code>.</p>

<p>Sidenote: Messaging is the only plugin which adds functions to the root of the Dangerfile.</p>
<h3>Reference</h3><h4>Methods</h4><div class="fake_code"></div><code>instance_name()</code><div class="fake_code"><p>Print markdown to below the table</p>
</div><code>markdown(<span class='subtle'>message</span><span class='subtle return'>String<span>)</code><div class="fake_code"><p>Print out a generate message on the PR</p>
</div><code>message(<span class='subtle'>message</span><span class='subtle return'>String<span>, <span class='subtle'>sticky:<span>)</code><div class="fake_code"><p>Specifies a problem, but not critical</p>
</div><code>warn(<span class='subtle'>message</span><span class='subtle return'>String<span>, <span class='subtle'>sticky:<span>)</code><div class="fake_code"><p>Declares a CI blocking error</p>
</div><code>fail(<span class='subtle'>message</span><span class='subtle return'>String<span>, <span class='subtle'>sticky:<span>)</code><div class="fake_code"><p>A list of all messages passed to Danger, including
the markdowns.</p>
</div><code>status_report()</code><div class="fake_code"><p>A list of all violations passed to Danger, we don&#39;t
anticipate users of Danger needing to use this.</p>
</div><code>violation_report()</code></article><article class="scope_code"><h3>Examples</h3><h4>Failing a build</h4><div class="highlight"><pre><span class="nb">fail</span> <span class="s2">&quot;This build didn&#39;t pass tests&quot;</span>
</pre></div><h4>Failing a build, but not keeping it's value around on subsequent runs</h4><div class="highlight"><pre><span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;This build didn&#39;t pass tests&quot;</span><span class="p">,</span> <span class="ss">sticky</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
</pre></div><h4>Passing a warning</h4><div class="highlight"><pre><span class="nb">warn</span> <span class="s2">&quot;This build didn&#39;t pass linting&quot;</span>
</pre></div><h4>Displaying a markdown table</h4><div class="highlight"><pre><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;### Proselint found issues</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Line | Message | Severity |</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;| --- | ----- | ----- |</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;20 | No documentation | Error </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">markdown</span> <span class="n">message</span>
</pre></div></article><div class="clearfix"></div></section></body></html>