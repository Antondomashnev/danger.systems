<html><head><meta charset="utf-8" /><!-- Always force latest IE rendering engine or request Chrome Frame --><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><title>Danger - Reference</title><link href="/stylesheets/style-7ed07f4e.css" rel="stylesheet" /><link href="/stylesheets/highlight-53578f94.css" rel="stylesheet" /><script src="https://code.jquery.com/jquery-3.0.0.slim.min.js"></script></head><body class="reference"><code class="byline">a project from <a href="http://orta.io">orta therox</a> and <a href="http://krausefx">felix krause</a>.</code><header class="title"><p>Danger</p><img src="/images/title-704b3238.png" class="retina" alt="Danger title image" width="980" height="236" /><nav><ul><li><a href="/">home</a></li><li><a href="/guides.html">Guides</a></li><li><a class="highlighted" href="/reference.html">Reference</a></li></ul></nav></header><section><h2><span>Reference</span></h2><article><h3>DangerfileGitPlugin</h3><p>Handles interacting with git inside a Dangerfile. Providing access to files that have changed, and useful statistics. Also provides
access to the commits in the form of <a href="https://github.com/schacon/ruby-git/blob/master/lib/git/log.rb">Git::Log</a> objects.</p>
<h3>Reference</h3><h4>Attributes</h4><h4>Methods</h4><div class="fake_code"></div><code>instance_name</code><div class="fake_code"></div><code>initialize</code><div class="fake_code"><p>Paths for files that were added during the diff</p>
</div><code>added_files</code><div class="fake_code"><p>Paths for files that were removed during the diff</p>
</div><code>deleted_files</code><div class="fake_code"><p>Paths for files that changed during the diff</p>
</div><code>modified_files</code><div class="fake_code"><p>The overall lines of code added/removed in the diff</p>
</div><code>lines_of_code</code><div class="fake_code"><p>The overall lines of code removed in the diff</p>
</div><code>deletions</code><div class="fake_code"><p>The overall lines of code added in the diff</p>
</div><code>insertions</code><div class="fake_code"><p>The log of commits inside the diff</p>
</div><code>commits</code></article><article><h3>Examples</h3><h4>Do something to all new and edited markdown files</h4><code><blockquote>
<br>markdowns = (git.added_files + git.modified_files)
<br>do_something markdowns.select{ |file| file.end_with? "md" }</blockquote></code><h4>Don't allow a file to be deleted</h4><code><blockquote>
<br>deleted = git.deleted_files.include? "my/favourite.file"
<br>fail "Don't delete my precious" if deleted</blockquote></code><h4>Fail really big diffs</h4><code><blockquote>
<br>fail "We cannot handle the scale of this PR" if git.lines_of_code > 50_000</blockquote></code><h4>Warn when there are merge commits in the diff</h4><code><blockquote>
<br>if commits.any? { |c| c.message =~ /^Merge branch 'master'/ }
<br>   warn 'Please rebase to get rid of the merge commits in this PR'
<br>end</blockquote></code><h3>Tags</h3><code></code><h3>See in Action</h3><ul><li><a href="https://github.com/danger/danger">danger/danger</a></li></ul></article><div class="clearfix"></div><article><h3>DangerfileGitHubPlugin</h3><p>Handles interacting with GitHub inside a Dangerfile. Provides a few functions which wrap <code>pr_json</code> and also
through a few standard functions to simplify your code.</p>
<h3>Reference</h3><h4>Attributes</h4><h4>Methods</h4><div class="fake_code"></div><code>initialize</code><div class="fake_code"></div><code>instance_name</code><div class="fake_code"><p>The title of the Pull Request.</p>
</div><code>pr_title</code><div class="fake_code"><p>The body text of the Pull Request.</p>
</div><code>pr_body</code><div class="fake_code"><p>The username of the author of the Pull Request.</p>
</div><code>pr_author</code><div class="fake_code"><p>The labels assigned to the Pull Request.</p>
</div><code>pr_labels</code><div class="fake_code"><p>The branch to which the PR is going to be merged into.</p>
</div><code>branch_for_base</code><div class="fake_code"><p>The branch to which the PR is going to be merged from.</p>
</div><code>branch_for_head</code><div class="fake_code"><p>The base commit to which the PR is going to be merged as a parent.</p>
</div><code>base_commit</code><div class="fake_code"><p>The head commit to which the PR is requesting to be merged from.</p>
</div><code>head_commit</code><div class="fake_code"><p>The hash that represents the PR&#39;s JSON. For an example of what this looks like
see the <a href="https://raw.githubusercontent.com/danger/danger/master/spec/fixtures/pr_response.json">Danger Fixture&#39;d one</a>.</p>
</div><code>pr_json</code><div class="fake_code"><p>Provides access to the GitHub API client used inside Danger. Making
it easy to use the GitHub API inside a Dangerfile.</p>
</div><code>api</code></article><article><h3>Examples</h3><h4>Warn when a PR is classed as work in progress</h4><code><blockquote>
<br>warn "PR is classed as Work in Progress" if github.pr_title.include? "[WIP]"</blockquote></code><h4>Ensure that labels have been used on the PR</h4><code><blockquote>
<br>fail "Please add labels to this PR" if github.labels.empty?</blockquote></code><h4>Check if a user is in a specific GitHub org, and message them if so</h4><code><blockquote>
<br>unless github.api.organization_member?('danger', github.pr_author)
<br>  message "@#{pr_author} is not a contributor yet, would you like to join the Danger org?"
<br>end</blockquote></code><h4>Ensure there is a summary for a PR</h4><code><blockquote>
<br>fail "Please provide a summary in the Pull Request description" if github.pr_body.length < 5</blockquote></code><h3>Tags</h3><code></code><h3>See in Action</h3><ul><li><a href="https://github.com/danger/danger">danger/danger</a></li></ul></article><div class="clearfix"></div><article><h3>DangerfileImportPlugin</h3><p>One way to support internal plugins is via <code>plugin.import</code> this gives you
the chance to quickly iterate without the need for building rubygems. As such,
it does not have the stringent rules around documentation expected of a public plugin.
It&#39;s worth noting, that you can also have plugins inside <code>./danger_plugins</code> and they
will be automatically imported into your Dangerfile at launch.</p>
<h3>Reference</h3><h4>Attributes</h4><h4>Methods</h4><div class="fake_code"></div><code>instance_name</code><div class="fake_code"><p>Download a local or remote plugin and use it inside the Dangerfile.</p>
</div><code>import</code></article><article><h3>Examples</h3><h4>Import a plugin available over HTTP</h4><code><blockquote>
<br>device_grid = "https://raw.githubusercontent.com/fastlane/fastlane/master/danger-device_grid/lib/device_grid/plugin.rb"
<br>plugin.import device_grid</blockquote></code><h4>Import from a local file reference</h4><code><blockquote>
<br>plugin.import "danger/plugins/watch_plugin.rb"</blockquote></code><h4>Import all files inside a folder</h4><code><blockquote>
<br>plugin.import "danger/plugins/*.rb"</blockquote></code><h3>Tags</h3><code></code><h3>See in Action</h3><ul><li><a href="https://github.com/danger/danger">danger/danger</a></li></ul></article><div class="clearfix"></div><article><h3>DangerfileMessagingPlugin</h3><p>Provides the feedback mechanism for Danger. Danger can keep track of
messages, warnings, failure and post arbitrary markdown into a comment.</p>

<p>The message within which Danger communicates back is amended on each run in a session.</p>

<p>Each of <code>message</code>, <code>warn</code> and <code>fail</code> have a <code>sticky</code> flag, <code>true</code> by default, which
means that the message will be crossed out instead of being removed. If it&#39;s not use on
subsequent runs.</p>

<p>By default, using <code>fail</code> would fail the corresponding build. Either via an API call, or
via the return value for the danger command.</p>

<p>It is possible to have Danger ignore specific warnings or errors by writing <code>Danger: Ignore &quot;[warning/error text]</code>.</p>

<p>Sidenote: Messaging is the only plugin which adds functions to the root of the Dangerfile.</p>
<h3>Reference</h3><h4>Attributes</h4><h4>Methods</h4><div class="fake_code"></div><code>initialize</code><div class="fake_code"></div><code>instance_name</code><div class="fake_code"><p>Print markdown to below the table</p>
</div><code>markdown</code><div class="fake_code"><p>Print out a generate message on the PR</p>
</div><code>message</code><div class="fake_code"><p>Specifies a problem, but not critical</p>
</div><code>warn</code><div class="fake_code"><p>Declares a CI blocking error</p>
</div><code>fail</code><div class="fake_code"><p>A list of all messages passed to Danger, including
the markdowns.</p>
</div><code>status_report</code><div class="fake_code"><p>A list of all violations passed to Danger, we don&#39;t
anticipate users of Danger needing to use this.</p>
</div><code>violation_report</code></article><article><h3>Examples</h3><h4>Failing a build</h4><code><blockquote>
<br>fail "This build didn't pass tests"</blockquote></code><h4>Failing a build, but not keeping it's value around on subsequent runs</h4><code><blockquote>
<br>fail("This build didn't pass tests", sticky: false)</blockquote></code><h4>Passing a warning</h4><code><blockquote>
<br>warn "This build didn't pass linting"</blockquote></code><h4>Displaying a markdown table</h4><code><blockquote>
<br>message = "### Proselint found issues\n\n"
<br>message << "Line | Message | Severity |\n"
<br>message << "| --- | ----- | ----- |\n"
<br>message << "20 | No documentation | Error \n"
<br>markdown message</blockquote></code><h3>Tags</h3><code></code><h3>See in Action</h3><ul><li><a href="https://github.com/danger/danger">danger/danger</a></li></ul></article><div class="clearfix"></div></section></body></html>