<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<!-- Always force latest IE rendering engine or request Chrome Frame --><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="True" name="HandheldFriendly">
<meta content="480" name="MobileOptimized">
<meta content="width=480, initial-scale=0.6" name="viewport">
<meta content="constant integration culture code" name="keywords">
<meta content="Orta Therox &amp; Felix Krause" name="author">
<meta content="summary" name="twitter:card">
<meta content="@orta" name="twitter:creator">
<meta content="Troubleshooting" name="twitter:title">
<meta content="Apply cultural rules during your CI process." name="twitter:description">
<meta content="http://danger.systems/guides/troubleshooting.html" name="twitter:url">
<meta content="/images/square-ffd55d21.png" property="og:image">
<meta content="http://danger.systems/guides/troubleshooting.html" property="og:url">
<title>Troubleshooting</title>
<link href="/stylesheets/style-35512886.css" rel="stylesheet">
<link href="/stylesheets/highlight-53578f94.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>
<body class="guides guides_troubleshooting">
<header class="title small"><p>Danger</p>
<a href="/"><img src="/images/title-88a50ec1.png" class="retina" alt="Danger title image"></a><nav><ul>
<li><a href="/">home</a></li>
<li><a class="highlighted" href="/guides.html">Guides</a></li>
<li class="big"><a href="/reference.html">Reference</a></li>
<li class="small"><a href="/reference.html">Ref</a></li>
</ul></nav></header><h2 class="reduced_top_margin">
<span>all broken</span><code class="byline inline">a project from <a target="_blank" href="http://orta.io">orta therox</a> and <a target="_blank" href="https://krausefx.com">felix krause</a>.</code>
</h2>
<div class="clearfix"></div>
<section class="guide"><article><h3 id="i-want-to-work-locally-on-my-dangerfile">
<a class="header-link" href="#i-want-to-work-locally-on-my-dangerfile">#</a>I want to work locally on my Dangerfile</h3>

<p>OK, so, you can use <code>bundle exec danger local</code> to have Danger run the last merged PR in your commit history ( note: run <code>bundle exec  danger local --help</code> to see extra options.)</p>

<p>This will run the Danger environment locally, making it possible to iterate and verify syntax etc.</p>

<p>For closed source projects, make sure to setup the <code>DANGER_GITHUB_API_TOKEN</code> environment variable before attempting to run <code>local</code>.  If you are trying to access an Enterprise Github instance, <code>DANGER_GITHUB_HOST</code> and <code>DANGER_GITHUB_API_HOST</code> must be set.</p>

<h3 id="i-want-to-only-run-danger-for-internal-branches">
<a class="header-link" href="#i-want-to-only-run-danger-for-internal-branches">#</a>I want to only run Danger for internal branches</h3>

<p>Let’s say you run Danger on the same CI service that deploys your code. If that’s open source, you don’t want to be letting a fork pull out your private env vars. The work around for this is to not simply call Danger on every test run:</p>

<pre><code class="sh">'[ ! -z $DANGER_GITHUB_API_TOKEN ] &amp;&amp; bundle exec danger || echo "Skipping Danger for External Contributor"'
</code></pre>

<p>This ensures that Danger only runs when you have the environment variables for her to use.</p>

<h3 id="i-want-to-be-a-danger-wizard">
<a class="header-link" href="#i-want-to-be-a-danger-wizard">#</a>I want to be a Danger Wizard</h3>

<p><img src="http://i.imgur.com/QCwKwKQ.gif" alt="Qcwkwkq"></p>

<p>Alright, alright. So the real key to working locally, is <code>bundle exec danger local --pry</code>.</p>

<p>Here’s some tips for using pry inside Danger. You will start off running the REPL <em>inside</em> the <code>Dangerfile</code>.</p>

<p><a href="http://pryrepl.org" target="_blank">Pry is special</a> because it provides a UNIX folder-like structure for your object graph. You can use <code>ls</code> to see all the local variables, and attributes for your current <code>Dangerfile</code>. Then use <code>cd</code> to change the state to another object, and <code>cd ..</code> to go back.</p>

<p>Inside the <code>Dangerfile</code>, plugin instances are not in the default list alas, but you can get them all with <code>@plugins.keys.map(&amp;:instance_name)</code>.</p>

<p>For example, to look around inside your <code>git</code> state, do a <code>cd git</code> and do <code>ls</code> again. If you want an in-depth overview of the current object use <code>inspect</code>.</p>

<p>To check all your warnings, errors, markdowns and messages - <code>cd</code> into the <code>messaging</code> plugin, then run <code>status_report</code> to see what has happened.</p>

<p>If you’re interested in understand pry more, I strongly recommend digging into <a href="http://pryrepl.org" target="_blank">their docs</a>.</p>

<h3 id="circle-ci-doesnt-run-my-build-consistently">
<a class="header-link" href="#circle-ci-doesnt-run-my-build-consistently">#</a>Circle CI doesnt run my build consistently</h3>

<p>Yeah… We’re struggling with that one. It’s something we keep taking stabs at improving, so <a href="https://github.com/danger/danger/search?q=circle&amp;state=open&amp;type=Issues&amp;utf8=%E2%9C%93" target="_blank">keep an eye on the issues</a>. Ideally this issue will get resolved and we’ll get it <a href="https://discuss.circleci.com/t/pull-requests-not-triggering-build/1213" target="_blank">fixed for free</a>.</p>
</article></section><section><article><hr>
<p>Got improvements? Help improve this document via <a href="https://github.com/danger/danger.systems/edit/master/static/source/guides/troubleshooting.html.md" target="_blank">sending PRs</a>.</p></article></section><footer><article><h3>GitHub</h3>
<ul><li><a href="https://github.com/danger/danger" target="_blank">danger/danger</a></li></ul>
<h3>Twitter</h3>
<ul>
<li><a href="https://twitter.com/orta" target="_blank">@orta</a></li>
<li><a href="https://twitter.com/krausefx" target="_blank">@krausefx</a></li>
</ul></article><article><h3>Guides</h3>
<ul>
<li><a href="/guides/getting_started.html">Getting Set Up</a></li>
<li><a href="/guides/dangerfile.html">The Dangerfile</a></li>
<li><a href="/guides/what_does_danger_do.html">What does Danger do?</a></li>
<li><a href="/guides/creating_your_first_plugin.html">Creating your first Plugin</a></li>
<li><a href="/guides/a_quick_ruby_overview.html">A Quick Ruby Overview</a></li>
<li><a href="/guides/faq.html">Frequently Asked Questions</a></li>
<li><a href="/guides/troubleshooting.html">Troubleshooting</a></li>
</ul></article><article><h3>Misc</h3>
<ul>
<li><a href="/reference.html">DSL Reference</a></li>
<li><a href="https://github.com/danger/danger/blob/master/CHANGELOG.md" target="_blank">CHANGELOG.md</a></li>
<li><a href="https://github.com/danger/design" target="_blank">Media Kit</a></li>
<li><a href="https://github.com/danger/danger#license-contributors-guidelines-and-code-of-conduct" target="_blank">COC / Moya CC</a></li>
<li><a href="https://github.com/danger/danger#im-here-to-help-out" target="_blank">Help Out Building Danger</a></li>
</ul></article><article><a href="/images/dm-opinions-316f5af1.png"><img height="244" src="/images/dm-opinions-316f5af1.png" width="203"></a></article></footer>
</body>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-81285417-1', 'auto');
ga('send', 'pageview');</script>
</html>
