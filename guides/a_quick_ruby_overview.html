<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta charset="utf-8">
<!-- Always force latest IE rendering engine or request Chrome Frame --><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="True" name="HandheldFriendly">
<meta content="480" name="MobileOptimized">
<meta content="width=480, initial-scale=0.6" name="viewport">
<meta content="constant integration culture code" name="keywords">
<meta content="Orta Therox &amp; Felix Krause" name="author">
<meta content="summary" name="twitter:card">
<meta content="@orta" name="twitter:creator">
<meta content="A Quick Ruby Overview" name="twitter:title">
<meta content="Apply cultural rules during your CI process." name="twitter:description">
<meta content="http://danger.systems/guides/a_quick_ruby_overview.html" name="twitter:url">
<meta content="/images/square-ffd55d21.png" property="og:image">
<meta content="http://danger.systems/guides/a_quick_ruby_overview.html" property="og:url">
<title>A Quick Ruby Overview</title>
<link href="/stylesheets/style-0eec9da9.css" rel="stylesheet">
<link href="/stylesheets/highlight-53578f94.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>
<body class="guides guides_a_quick_ruby_overview">
<header class="title small"><p>Danger</p>
<a href="/"><img src="/images/title-88a50ec1.png" class="retina" alt="Danger title image"></a><nav><ul>
<li><a href="/">home</a></li>
<li><a class="highlighted" href="/guides.html">Guides</a></li>
<li class="big"><a href="/reference.html">Reference</a></li>
<li class="small"><a href="/reference.html">Ref</a></li>
</ul></nav></header><h2 class="reduced_top_margin">
<span>Ruby</span><code class="byline inline">a project from <a target="_blank" href="http://orta.io">orta therox</a> and <a target="_blank" href="https://krausefx.com">felix krause</a>.</code>
</h2>
<div class="clearfix"></div>
<section class="guide"><article><h3 id="aims-of-this-guide">
<a class="header-link" href="#aims-of-this-guide">#</a>Aims of this Guide</h3>

<p>My assumption is that you are a programmer, with some experience. You should be familiar with the terminal. This guide aims to cover enough Ruby for you to feel somewhat productive. You don’t need to know all of the details of the language, but you should probably have some familiarity with a few of these major topics.</p>

<p>Ruby has a repl, the best one by far is <code>pry</code>. So, if you want to have a play with the language. Run <code>gem install pry</code> then run <code>pry</code>. If the gem does not install, you should follow <a href="https://guides.cocoapods.org/using/getting-started.html#sudo-less-installation">the instructions here</a> to do a sudo-less install.</p>

<h3 id="environment">
<a class="header-link" href="#environment">#</a>Environment</h3>

<p>The <code>Dangerfile</code> is a scripting environment, this means that you can totally get by with some simple hacking. Inside the Dangerfile, you only need to understand how to manipulate the data exposed via the API. You can see the full extent of the DSL in <a href="/reference.html">the reference</a> and from the plugins overview in the <a href="/">homepage</a>.</p>

<p>Realistically, the DSL is small. To be productive in your <code>Dangerfile</code> you will need to use Ruby to put the pieces together. You don’t need to be a pro at Ruby though, as you’ll mostly be doing string and array manipulation, file accessing, and executing shell commands. Which is what we’ll cover here.</p>

<h3 id="variables-and-keyword-syntax">
<a class="header-link" href="#variables-and-keyword-syntax">#</a>Variables and Keyword Syntax</h3>

<p>Ruby does not have a keyword for variables, so you can write <code>path = "./the/path"</code> and you can re-use it later on.</p>

<p>For methods, parentheses are optional. You can write <code>do_something</code> and <code>do_something()</code>. Method parameters are fine with this too: <code>do_something "OK", 3</code>. Danger tries to use named parameters a lot, so you might end up writing <code>do_something "OK", times: 3</code>.</p>

<p>If statements are cool in Ruby, here’s some interesting cases:</p>

<p>Plain old if statement:
<code>ruby
if three == 3
  do_something
end
</code></p>

<p>For single actions, you can move it before the <code>if</code>, this is succinct, and matches how English reads:</p>

<pre><code class="ruby">do_something if three == 3
</code></pre>

<p>If you need to negate something, you can use <code>unless</code> instead of a <code>!</code>:</p>

<pre><code class="ruby">unless three == 3
  not_something
end
</code></pre>

<h3 id="strings">
<a class="header-link" href="#strings">#</a>Strings</h3>

<p>You can use both double and single quotes to create a string, though single quotes don’t do interpolation. This means you should nearly always use double quotes.</p>

<p>If a function has a <code>!</code> in it, that generally means it mutates the object. Otherwise you get a change if there’s an <code>=</code> in the LOC.</p>

<pre><code class="ruby">name = "orta"                 # orta
name += " therox"             # orta therox
name.start_with? "orta"       # true
name.end_with? "orta"         # false
name.gsub "orta", "Orta"      # Orta therox
name.gsub /therox/, 'Therox'  # orta Therox
# Note the !, this will mutate `name`.
name.gsub! /therox/, 'Therox' # orta Therox
name.include? "ta thero"      # false
name.include? "Thero"         # true
name[0..3]                    # orta
</code></pre>

<p>There are multiple ways to make a string, I recommend using double quotes <code>"</code> like above. If you want to do string interpolation with it, you can use <code>#{}</code> and run code inside the brackets. <code>"5 = ${ 2+3 }"</code>.</p>

<p>That should be enough to play around with your code review data.</p>

<h3 id="arrays-closures">
<a class="header-link" href="#arrays-closures">#</a>Arrays + Closures</h3>

<p>Arrays are also mostly immutable, it’s common to iterate with <code>array.each</code> instead of <code>for thing in array</code>. Closures for functions like <code>each</code>, <code>map</code>, <code>select</code>, <code>flat_map</code>, <code>reject</code> and the like, can be executed with a single line with braces:</p>

<pre><code class="ruby">paths.map { |path| File.read(path) }.select { |content| content.include? "orta" }
</code></pre>

<p>For longer closures, it’s common to use <code>do</code> and <code>end</code>:</p>

<pre><code class="ruby">paths.each do |path|
  path.name += "Dangerfile"
  do_something path
end
</code></pre>

<p>Finally, the simplest “closure”, that only works if you want to call a function on the object in your collection is this interesting pattern: <code>lowercase_path = paths.map(&amp;:downcase)</code> - where <code>downcase</code> is a function on the strings in the array.</p>

<p><code>Note:</code> In Danger, for lists of files (e.g.<code>git.modified_files</code>) we use a class called a <code>FileList</code> which is an array subclass. <a href="https://github.com/danger/danger/blob/master/spec/lib/danger/core_ext/file_list_spec.rb">This adds one extra method</a>: <code>include?</code>. This lets you use <a href="http://wiki.bash-hackers.org/syntax/expansion/globs">path globbing</a> to determine if a string is in the list:</p>

<pre><code class="ruby">paths = ["path1/file_name.txt", "path1/file_name1.txt", "path2/subfolder/example.json"]
filelist = Danger::FileList.new(paths)

filelist.include? "path1/file_name.txt"   # true
filelist.include? "path2/*.json"          # true
filelist.include? "path1/*.json"          # false
</code></pre>

<h3 id="files">
<a class="header-link" href="#files">#</a>Files</h3>

<p>You can read a file with <code>File.read("path/to/file")</code> this returns a string, or nil. Paths within Danger are represented as strings.</p>

<h3 id="terminal-commands">
<a class="header-link" href="#terminal-commands">#</a>Terminal commands</h3>

<p>There are three ways to interact with commands to do something.</p>

<p>The humble backtick ` - Takes whatever shell command you want to run, and returns a string of the output, and a final newline. You don’t see any output by default.</p>

<pre><code class="ruby">plugin_json = `bundle exec danger plugin json`
</code></pre>

<p><code>system</code> - Outputs the command you run in the shell, it will return <code>true</code> if the process succeeded.</p>

<pre><code class="ruby">send_congrats if system("gem install pry")
</code></pre>

<p><code>exec</code> - Replaces the current process with another, you probably won’t be needing this for Danger.</p>

<p>If you want to know more about any of these, check out <a href="http://stackoverflow.com/questions/6338908/ruby-difference-between-exec-system-and-x-or-backticks">this Stack Overflow</a>.</p>

<h3 id="json-parsing">
<a class="header-link" href="#json-parsing">#</a>JSON Parsing</h3>

<p>To work with JSON data, you <em>may</em> have to <code>require</code> the JSON library first. Note some systems are case-sensitive, so always do <code>require "json"</code>. I keep getting this wrong, it’s always in lowercase. :D</p>

<p>For example grabbing some JSON data, parsing it, then pulling something out:</p>

<pre><code class="ruby">path = "path/to/file.json"
contents = File.read path

require "json"
json = JSON.parse contents

thing = json["things"][0]
</code></pre>

<h3 id="running-a-dangerfile-inside-irb">
<a class="header-link" href="#running-a-dangerfile-inside-irb">#</a>Running a Dangerfile inside IRB</h3>

<p>There’s a <a href="/guides/troubleshooting.html#i-want-to-be-a-danger-wizard">great section in the troubleshooting</a> on letting you dig around inside Danger via <code>pry</code>.</p>
</article></section><section><article><hr>
<p>Got improvements? Help improve this document via <a href="https://github.com/danger/danger.systems/edit/master/static/source/guides/a_quick_ruby_overview.html.md">sending PRs</a>.</p></article></section><footer><article><h3>GitHub</h3>
<ul><li><a href="https://github.com/danger/danger">danger/danger</a></li></ul>
<h3>Twitter</h3>
<ul>
<li><a href="https://twitter.com/orta" target="_blank">@orta</a></li>
<li><a href="https://twitter.com/krausefx" target="_blank">@krausefx</a></li>
</ul></article><article><h3>Guides</h3>
<ul>
<li><a href="/guides/getting_started.html">Getting Set Up</a></li>
<li><a href="/guides/dangerfile.html">The Dangerfile</a></li>
<li><a href="/guides/what_does_danger_do.html">What does Danger do?</a></li>
<li><a href="/guides/creating_your_first_plugin.html">Creating your first Plugin</a></li>
<li><a href="/guides/a_quick_ruby_overview.html">A Quick Ruby Overview</a></li>
<li><a href="/guides/faq.html">Frequently Asked Questions</a></li>
<li><a href="/guides/troubleshooting.html">Troubleshooting</a></li>
</ul></article><article><h3>Misc</h3>
<ul>
<li><a href="/reference.html">DSL Reference</a></li>
<li><a href="https://github.com/danger/danger/blob/master/CHANGELOG.md">CHANGELOG.md</a></li>
<li><a href="https://github.com/danger/design">Media Kit</a></li>
<li><a href="https://github.com/danger/danger#license-contributors-guidelines-and-code-of-conduct">Code of Conduct</a></li>
<li><a href="https://github.com/danger/danger#license-contributors-guidelines-and-code-of-conduct">Community Continuity</a></li>
</ul></article><article><a href="/images/dm-opinions-316f5af1.png"><img height="244" src="/images/dm-opinions-316f5af1.png" width="203"></a></article></footer>
</body>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-81285417-1', 'auto');
ga('send', 'pageview');</script>
</html>
