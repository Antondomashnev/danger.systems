<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<!-- Always force latest IE rendering engine or request Chrome Frame --><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="True" name="HandheldFriendly">
<meta content="480" name="MobileOptimized">
<meta content="width=480, initial-scale=0.6" name="viewport">
<meta content="constant integration culture code" name="keywords">
<meta content="Orta Therox &amp; Felix Krause" name="author">
<meta content="summary" name="twitter:card">
<meta content="@orta" name="twitter:creator">
<meta content="Creating your first Plugin" name="twitter:title">
<meta content="Apply cultural rules during your CI process." name="twitter:description">
<meta content="http://danger.systems/guides/creating_your_first_plugin.html" name="twitter:url">
<meta content="/images/square-ffd55d21.png" property="og:image">
<meta content="http://danger.systems/guides/creating_your_first_plugin.html" property="og:url">
<title>Creating your first Plugin</title>
<link href="/stylesheets/style-0eec9da9.css" rel="stylesheet">
<link href="/stylesheets/highlight-53578f94.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>
<body class="guides guides_creating_your_first_plugin">
<header class="title small"><p>Danger</p>
<a href="/"><img src="/images/title-88a50ec1.png" class="retina" alt="Danger title image"></a><nav><ul>
<li><a href="/">home</a></li>
<li><a class="highlighted" href="/guides.html">Guides</a></li>
<li class="big"><a href="/reference.html">Reference</a></li>
<li class="small"><a href="/reference.html">Ref</a></li>
</ul></nav></header><h2 class="reduced_top_margin">
<span>Plugin creation</span><code class="byline inline">a project from <a target="_blank" href="http://orta.io">orta therox</a> and <a target="_blank" href="https://krausefx.com">felix krause</a>.</code>
</h2>
<div class="clearfix"></div>
<section class="guide"><article><p>So, you want to make a Danger Plugin? This is <em>awesome</em>. We all have common issues, and this is a great way to share code with the world. We’ve found once a single rule becomes longer than 10-15 lines of code, converting it into a plugin </p>

<p>The concept of a Plugin in Danger is very simple. It’s a subclass of <code>Danger::Plugin</code>. </p>

<p>If you don’t know about Ruby modules, then don’t worry, think of it as Ruby namespacing. That’s the <code>Danger::</code> bit. You’ll have to create a class that is a subclass of <code>Plugin</code> inside a <code>Danger</code> <code>module</code>.</p>

<h3 id="tech-specs">
<a class="header-link" href="#tech-specs">#</a>Tech Specs</h3>

<p>This subclass will be created automatically with a reference to the current <code>Danger::Dangerfile</code> ruby object. It will be created before the <code>Dangerfile</code>(<a href="/guides/faq.html#i-want-to-run-danger-across-multiple-repos">s</a>) are parsed by it. </p>

<p>There are no ways to automatically execute code with knowledge of the current status. A plugin should get told to do some work from the user’s <code>Dangerfile</code>(s).  </p>

<p>Your plugin is added as an attribute to the user’s <code>Dangerfile</code>(s), this is based on your class name, but is editable. </p>

<pre><code class="ruby">def self.instance_name
  to_s.gsub("Danger", "").danger_underscore.split("/").last
end

# e.g. removes "Danger", converts camel case to snake case, and splits if there's any /s

# DangerProse -&gt; prose
# DangerMyThing -&gt; my_thing
# MyPlugin -&gt; my_plugin 
</code></pre>

<h4 id="same-source">
<a class="header-link" href="#same-source">#</a>Same Source</h4>

<p>One of the great things about a Danger Plugin, is that the code is exactly the same as it was in your <code>Dangerfile</code>. A plugin has access to all of the same methods and attributes as you had when it was being parsed inside a <code>Dangerfile</code>. This is because anything your plugin doesn’t understand get’s first pass to see if it’s reference to the current <code>Dangerfile</code> understands.</p>

<p>This is useful mainly in two things: </p>

<ul>
<li>Low barrier to entry.</li>
<li>You have access to all of the other plugins.</li>
</ul>

<h3 id="creating-the-plugin">
<a class="header-link" href="#creating-the-plugin">#</a>Creating the Plugin</h3>

<p>Starting is pretty simple, we have a <a href="https://github.com/danger/danger-plugin-template">template</a>. As well as a command to get you started. Your first step is the name, the <a href="http://guides.rubygems.org/name-your-gem/">Rubygems rule</a> is <code>[core_app]-[gem]_[name]</code>. So, the first space is always a <code>-</code> then later spaces would be <code>_</code>. E.g. <code>danger-wizard_hat</code>.</p>

<p>Now you know the rules, in your development folder run <code>danger plugins create [name]</code>. This will create a README similar to <a href="https://github.com/dbgrandi/danger-prose/tree/d80e1b54a6df859c624015895f4d5d79fd11a276">danger-proselint</a>’s</p>

<pre><code>$ danger plugins create guitar_lessons

-&gt; Creating `danger-guitar_lessons` plugin

[!] using template 'https://github.com/danger/danger-plugin-template'
-&gt; Configuring template
Configuring danger-guitar_lessons
user name:Orta Therox
user email:orta.therox@gmail.com
year:2016
</code></pre>

<p>This sets you up with this folder structure:</p>

<pre><code>danger-guitar_lessons
├── .travis.yml
├── Gemfile
├── Guardfile
├── LICENSE.txt
├── README.md
├── Rakefile
├── danger-guitar_lessons.gemspec
├── lib
│   ├── danger_guitar_lessons.rb
│   ├── danger_plugin.rb
│   └── guitar_lessons
│       ├── gem_version.rb
│       └── plugin.rb
└── spec
    ├── guitar_lessons_spec.rb
    └── spec_helper.rb
</code></pre>

<p>Which covers a lot of the basics for you</p>

<h4 id="source">
<a class="header-link" href="#source">#</a>Source</h4>

<p>The template isn’t empty, it comes as an existing simple plugin based on our work in <a href="https://github.com/dbgrandi/danger-prose/">danger-prose</a>. This is to make it easier to show how all of the plugin comes together, I’d recommend reading through these files in this order:</p>

<ul>
<li><code>/lib/[NAME]/plugin.rb</code></li>
<li><code>/spec/spec_helper.rb</code></li>
<li><code>/spec/[NAME]_spec.rb</code></li>
</ul>

<p>as these are main places where you would be doing work.</p>

<p>You’ll want to move your code into the file at <code>/lib/[NAME]/plugin.rb</code>. Then you can write some tests to ensure nothing will break in the future. </p>

<h4 id="tests">
<a class="header-link" href="#tests">#</a>Tests</h4>

<p>The template comes with some tests for the example plugin. It already comes with infrastructure to have a <code>Danger::Dangerfile</code> instantiate your plugin. You can start off by modifying that to work with your plugin.</p>

<p>To run all of the tests, you can use the command <code>bundle exec rake spec</code>. The testing infrastructure is <a href="http://rspec.info">RSpec</a>, the template also comes with a <code>Guardfile</code> for use with <a href="http://guardgem.org">guard</a> with <a href="https://github.com/guard/guard-rspec">guard-rspec</a>. This means you can run <code>bundle exec guard</code> and it will start a server which listens for test changes and re-runs your tests as you work. </p>

<p>If you’re new to testing on ruby, here are some examples that you can use as a reference:</p>

<ul>
<li><a href="https://github.com/dbgrandi/danger-prose/blob/cc2c618abafc9e9435a783ffa0ebca5beef4f897/spec/danger_plugin_spec.rb"><code>danger-proselint - danger_plugin_spec.rb</code></a></li>
<li><a href="https://github.com/danger/danger/blob/6daa85167efff1659bbee895b3e9a9fba0b1c9ec/spec/lib/danger/request_sources/request_source_spec.rb"><code>danger - request_source_spec.rb</code></a></li>
<li><a href="https://github.com/danger/danger/blob/master/spec/lib/danger/core_ext/string_spec.rb"><code>danger - string_spec.rb</code></a></li>
<li><a href="https://github.com/ashfurrow/danger-rubocop/blob/bef4a28b4d542810a1aeb0d7460a80a8ab842492/spec/danger_plugin_spec.rb"><code>danger-rubocop - danger_plugin_spec.rb</code></a></li>
</ul>

<h4 id="ci">
<a class="header-link" href="#ci">#</a>CI</h4>

<p>This template comes with a <code>.travis.yml</code> file that lints your documentation, and offers advice on the syntax of your Ruby. If you want to quickly change the syntax, run <code>bundle exec rubocop -a</code> in the directory. </p>

<h4 id="adding-the-gem-to-your-project">
<a class="header-link" href="#adding-the-gem-to-your-project">#</a>Adding the Gem to your Project</h4>

<p>To test your project back with the codebase you’ve extracted the code from, you’ll need to use a <code>Gemfile</code>. So many <code>Thingfile</code>s, right? </p>

<p>You should add a <code>gem</code> using the <code>:path</code> attribute. e.g. add a new line with:</p>

<pre><code class="ruby">gem "danger-guitar_lessons", :path =&gt; "../danger-guitar_lessons"
</code></pre>

<p>Then when you run <code>bundle install</code> your new gem is added to the project. You can then use <code>bundle exec danger local</code> to test inside you project. You can make changes to your plugin, then you only need to run <code>bundle exec danger local</code>.</p>

<h3 id="automate-your-readme">
<a class="header-link" href="#automate-your-readme">#</a>Automate your README</h3>

<p>Danger can generate your README based on the inline documentation in your plugin. To do this, run <code>bundle exec danger plugins readme</code>. The markdown will be output into your terminal, then you can copy &amp; paste it into <code>README.md</code>.</p>

<h3 id="pushing-to-rubygems">
<a class="header-link" href="#pushing-to-rubygems">#</a>Pushing to RubyGems</h3>

<p>So you’re ready to ship now, you’ve got a few tests, and you’ve ran it inside your project using a <code>:path</code> <code>gem</code>. </p>

<p>You’re going to want to push it to <a href="https://rubygems.org">RubyGems</a>, here’s their guide on <a href="http://guides.rubygems.org/publishing/#publishing-to-rubygemsorg">publishing a gem</a>.</p>

<p>Once it’s on RubyGems, then you should change your application’s Gemfile to remove the <code>:path</code> and let it become the public gem. Awesome. That’s you ready for using your plugin in production.</p>

<h3 id="getting-it-on-danger-systems">
<a class="header-link" href="#getting-it-on-danger-systems">#</a>Getting it on Danger.Systems</h3>

<p>Having a plugin available on RubyGems means anyone can use it. </p>

<p>This is entirely optional, however having your gem on this site means that it will be more visible! </p>

<p>In order to go on Danger.Systems you need to ensure the running <code>bundle exec danger plugins lint</code> passes. </p>

<p>This means that the plugin is well documented so that the site can generate a page for it. The linter will guide you through the process, and show you examples of how to use the documentation syntax.</p>

<p>Once you are all green, and ideally warning free in the linter. You should send a pull request to <a href="https://github.com/danger/danger.systems/edit/master/plugins.json">danger.systems/plugins.json</a>. Please don’t add it as the first item.</p>

<h4 id="--would-plugin-again">
<a class="header-link" href="#--would-plugin-again">#</a>10/10 WOULD PLUGIN AGAIN</h4>
</article></section><section><article><hr>
<p>Got improvements? Help improve this document via <a href="https://github.com/danger/danger.systems/edit/master/static/source/guides/creating_your_first_plugin.html.md">sending PRs</a>.</p></article></section><footer><article><h3>GitHub</h3>
<ul><li><a href="https://github.com/danger/danger">danger/danger</a></li></ul>
<h3>Twitter</h3>
<ul>
<li><a href="https://twitter.com/orta" target="_blank">@orta</a></li>
<li><a href="https://twitter.com/krausefx" target="_blank">@krausefx</a></li>
</ul></article><article><h3>Guides</h3>
<ul>
<li><a href="/guides/getting_started.html">Getting Set Up</a></li>
<li><a href="/guides/dangerfile.html">The Dangerfile</a></li>
<li><a href="/guides/what_does_danger_do.html">What does Danger do?</a></li>
<li><a href="/guides/creating_your_first_plugin.html">Creating your first Plugin</a></li>
<li><a href="/guides/a_quick_ruby_overview.html">A Quick Ruby Overview</a></li>
<li><a href="/guides/faq.html">Frequently Asked Questions</a></li>
<li><a href="/guides/troubleshooting.html">Troubleshooting</a></li>
</ul></article><article><h3>Misc</h3>
<ul>
<li><a href="/reference.html">DSL Reference</a></li>
<li><a href="https://github.com/danger/danger/blob/master/CHANGELOG.md">CHANGELOG.md</a></li>
<li><a href="https://github.com/danger/design">Media Kit</a></li>
<li><a href="https://github.com/danger/danger#license-contributors-guidelines-and-code-of-conduct">COC / Moya CC</a></li>
<li><a href="https://github.com/danger/danger#im-here-to-help-out">Help Out Building Danger</a></li>
</ul></article><article><a href="/images/dm-opinions-316f5af1.png"><img height="244" src="/images/dm-opinions-316f5af1.png" width="203"></a></article></footer>
</body>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-81285417-1', 'auto');
ga('send', 'pageview');</script>
</html>
